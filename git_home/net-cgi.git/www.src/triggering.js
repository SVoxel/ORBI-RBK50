var invalid_port_used="$invalid_port_used";function checkPort(d,a){var e="";var b=parseInt(a,10);if(a.length==0){e=d+" $trigger_null";alert(e);return false}for(i=0;i<a.length;i++){c=a.charAt(i);if("0123456789".indexOf(c,0)<0){e="$trigger_invalid"+d;alert(e);return false}}if(isNaN(b)||b<1||b>65535){e="$trigger_invalid"+d+"$trigger_1_65535";alert(e);return false}return true}function setsrc(b){var a=b.src_ip_type.selectedIndex;if(a==1){b.src_ip1.disabled=false;b.src_ip2.disabled=false;b.src_ip3.disabled=false;b.src_ip4.disabled=false}else{b.src_ip1.disabled=true;b.src_ip2.disabled=true;b.src_ip3.disabled=true;b.src_ip4.disabled=true}}function check_triggering_add(cf,flag){var all_port_num=0;if(flag=="add"){for(i=1;i<=trigger_array_num;i++){var str=eval("triggeringArray"+i);var each_info=str.split(" ");constart_port=each_info[6];conend_port=each_info[7];all_port_num=all_port_num+parseInt(conend_port)-parseInt(constart_port)+1}}else{if(flag=="edit"){for(i=1;i<=trigger_array_num;i++){if(select_editnum!=i){var str=eval("triggeringArray"+i);var each_info=str.split(" ");constart_port=each_info[6];conend_port=each_info[7];all_port_num=all_port_num+parseInt(conend_port)-parseInt(constart_port)+1}}}}if(trigger_array_num==20&&flag=="add"){alert("$trigger_length_20");return false}if(cf.pt_name.value==""){alert("$trigger_ser_name_null");return false}for(i=0;i<cf.pt_name.value.length;i++){if(isValidChar_space(cf.pt_name.value.charCodeAt(i))==false){alert("$servname_not_allowed");return false}}cf.pt_name.value=cf.pt_name.value.replace(/ /g,"&harr;");for(i=1;i<=trigger_array_num;i++){var str=eval("triggeringArray"+i).replace(/&#92;/g,"\\").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#40;/g,"(").replace(/&#41;/g,")").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&#35;/g,"#").replace(/&#38;/g,"&");var each_info=str.split(" ");each_info[0]=each_info[0].replace(/&harr;/g," ");if(flag=="edit"){if(cf.pt_name.value==each_info[0]&&select_editnum!=i){alert("$trigger_ser_name_dup");return false}}else{if(cf.pt_name.value==each_info[0]){alert("$trigger_ser_name_dup");return false}}}var type=cf.src_ip_type.selectedIndex;if(type==0){cf.service_ip.value="any"}else{cf.service_ip.value=cf.src_ip1.value+"."+cf.src_ip2.value+"."+cf.src_ip3.value+"."+cf.src_ip4.value;if(checkipaddr(cf.service_ip.value)==false||is_sub_or_broad(cf.service_ip.value,lan_ip,lan_subnet)==false){alert("$invalid_ip");return false}cf.service_ip.value=address_parseInt(cf.service_ip.value);if(isSameSubNet(cf.service_ip.value,lan_subnet,lan_ip,lan_subnet)==false){alert("$diff_lan_this_subnet");return false}if(isSameIp(cf.service_ip.value,lan_ip)==true){alert("$invalid_ip");return false}}if(checkPort("$trigger_port",cf.pt_port.value)==false){return false}cf.pt_port.value=parseInt(cf.pt_port.value,10);if(checkPort("$block_ser_start_port",cf.in_port_start.value)==false){return false}cf.in_port_start.value=parseInt(cf.in_port_start.value,10);if(cf.in_port_end.value.length>0){if(checkPort("$block_ser_end_port",cf.in_port_end.value)==false){return false}cf.in_port_end.value=parseInt(cf.in_port_end.value,10);if(parseInt(cf.in_port_end.value)<parseInt(cf.in_port_start.value)){alert("$trigger_invalid_port_rang");return false}}if(cf.in_port_end.value.length==0){cf.in_port_end.value=cf.in_port_start.value}var now_port_num=cf.in_port_end.value-cf.in_port_start.value+1;all_port_num=all_port_num+now_port_num;var input_start_port=cf.in_port_start.value;var input_end_port=cf.in_port_end.value;var input_sertype=cf.in_port_type.value;for(i=1;i<=forward_array_num;i++){var str=eval("forwardingArray"+i).replace(/&#92;/g,"\\").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#40;/g,"(").replace(/&#41;/g,")").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&#35;/g,"#").replace(/&#38;/g,"&");var each_info=str.split(" ");sertype=each_info[1];startport=each_info[2];endport=each_info[3];serip=each_info[6];serflag=each_info[7];if(sertype=="UDP"&&serflag=="1"){}else{if(!(parseInt(endport)<parseInt(input_start_port)||parseInt(input_end_port)<parseInt(startport))){if((sertype=="TCP/UDP"||input_sertype=="TCP/UDP"||input_sertype==sertype)&&(cf.service_ip.value=="any"||cf.service_ip.value!=serip)){alert(invalid_port_used);return false}}}}for(i=1;i<=trigger_array_num;i++){var str=eval("triggeringArray"+i).replace(/&#92;/g,"\\").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#40;/g,"(").replace(/&#41;/g,")").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&#35;/g,"#").replace(/&#38;/g,"&");var each_info=str.split(" ");trigip=each_info[2];consertype=each_info[5];constart_port=each_info[6];conend_port=each_info[7];if(flag=="edit"){if((!(parseInt(conend_port)<parseInt(input_start_port)||parseInt(input_end_port)<parseInt(constart_port)))&&select_editnum!=i){if((consertype=="TCP/UDP"||input_sertype=="TCP/UDP"||input_sertype==consertype)&&select_editnum!=i&&cf.service_ip.value!="any"&&trigip!="any"&&cf.service_ip.value!=trigip){alert(invalid_port_used);return false}}}else{if(!(parseInt(conend_port)<parseInt(input_start_port)||parseInt(input_end_port)<parseInt(constart_port))){if((consertype=="TCP/UDP"||input_sertype=="TCP/UDP"||input_sertype==consertype)&&cf.service_ip.value!="any"&&trigip!="any"&&cf.service_ip.value!=trigip){alert(invalid_port_used);return false}}}}for(i=1;i<=upnp_array_num;i++){var str=eval("upnpArray"+i);var each_info=str.split(";");upnp_protocal=each_info[1];upnp_int=each_info[2];upnp_ext=each_info[3];upnp_ip=each_info[4];if(!(parseInt(upnp_ext)<parseInt(input_start_port)||parseInt(input_end_port)<parseInt(upnp_int))&&cf.service_ip.value!=upnp_ip){if(upnp_protocal=="TCP/UDP"||input_sertype=="TCP/UDP"||input_sertype==upnp_protocal){alert(invalid_port_used);return false}}}if(usb_router_flag==1){if(input_sertype!="UDP"){if(check_readyshare_port(input_start_port,input_end_port,"WAN")==false){alert(invalid_port_used);return false}}}if(endis_remote=="1"&&input_sertype!="UDP"){if(!(parseInt(remote_port)<parseInt(input_start_port)||parseInt(input_end_port)<parseInt(remote_port))&&remote_port!=""){alert(invalid_port_used);return false}}if(parseInt(input_start_port)<=123&&parseInt(input_end_port)>=123&&endis_ntp=="1"&&input_sertype!="TCP"){alert(invalid_port_used);return false}if(parseInt(input_start_port)<=1900&&parseInt(input_end_port)>=1900&&endis_upnp=="1"&&input_sertype!="TCP"){alert(invalid_port_used);return false}if(parseInt(input_start_port)<=5050&&parseInt(input_end_port)>=5050&&info_get_wanproto=="bigpond"&&input_sertype!="TCP"){alert(invalid_port_used);return false}cf.pt_port.value=port_range_interception(cf.pt_port.value);cf.in_port_start.value=port_range_interception(cf.in_port_start.value);cf.in_port_end.value=port_range_interception(cf.in_port_end.value);if(typeof(apply_flag)!="undefined"){apply_flag=1}cf.submit();return true}function check_triggering_edit(b){if(array_num==0){location.href="edit_fail.htm";return false}var d=0;var a;if(array_num==1){if(b.serviceSelect.checked==true){d++;a=1}}else{for(i=0;i<array_num;i++){if(b.serviceSelect[i].checked==true){d++;a=i+1}}}if(d==0){location.href="edit_fail.htm";return false}else{b.select_edit.value=a;b.submit_flag.value="triggering_editnum";b.action="/apply.cgi?/triggering_edit.htm timestamp="+ts;b.submit();return true}}function check_triggering_del(b){if(array_num==""){location.href="del_fail.htm";return false}var d=0;var a;if(array_num==1){if(b.serviceSelect.checked==true){d++;a=1}}else{for(i=0;i<array_num;i++){if(b.serviceSelect[i].checked==true){d++;a=i+1}}}if(d==0){location.href="del_fail.htm";return false}else{b.select_del.value=a;b.submit_flag.value="triggering_del";b.submit();return true}}function check_triggering_apply(a){if(a.fwpt_enable.checked==true){a.disable_trigger_on.value=1}else{a.disable_trigger_on.value=0}if(a.fwpt_timeout.value==""){alert("$timeout_null");return false}else{if(!_isNumeric(a.fwpt_timeout.value)){alert("$invalid_trigger_timeout");return false}}a.fwpt_timeout.value=parseInt(a.fwpt_timeout.value,10);if(array_num==0){}else{if(array_num==1){if(a.enable_triggering.checked==true){a.endis_trigger_value.value="1"}else{a.endis_trigger_value.value="0"}}else{for(i=0;i<array_num;i++){if(a.enable_triggering[i].checked==true){a.endis_trigger_value.value=a.endis_trigger_value.value+"1,"}else{a.endis_trigger_value.value=a.endis_trigger_value.value+"0,"}}}}a.submit();return true}function back_reload_page(a){console.log("back_flag=%s",top.back_flag);if(top.back_flag==1){location.href=a;top.back_flag=0}};