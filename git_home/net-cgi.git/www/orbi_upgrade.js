function see_detail(a){var b=window.open("UPG_show_version.htm?num="+a,"fw_status","width=625,height=400,top=70,left=230,status=yes,resizable=yes,scrollbars=yes");b.focus()}var MAX_UPG_TRIES=30,MAX_CHK_TRIES=75;var wait_time=0,check_satellite_times=0;var newVer_count=0,router_newVer=0;var timeout;var fw_info=new Array();var dropped_num=0,upg_flag=1;function update_fw_info(type,json){var null_dev_num=0;eval(json);fw_info=[];var base_obj={type:router_status_router,mac:"",modelname:base_dev_info["module name"],devname:base_dev_info["device name"],curver:base_dev_info["current version"],newver:base_check_info["new version"],chkstatus:base_check_info["check status"],upgstatus:base_upg_info["upgrade status"],urlstatus:base_url_status["url status"],detail_num:0};fw_info.push(base_obj);update_devname();for(var i=0,len=ext_dev_info.length;i<len;i++){var obj={};if(ext_dev_info[i]["mac address"]==undefined){null_dev_num++;continue}obj.type=ORT_005;obj.mac=ext_dev_info[i]["mac address"];obj.modelname=ext_dev_info[i]["module name"];obj.devname=ext_dev_info[i]["device name"];obj.bhstatus=ext_dev_info[i]["backhaul status"];obj.curver=ext_dev_info[i]["current version"];obj.newver="0";obj.chkstatus="0";obj.upgstatus="0";obj.detail_num=-1;for(var j=0,len2=ext_check_info.length;j<len2;j++){if(ext_check_info[j]["mac address"]==obj.mac){obj.newver=ext_check_info[j]["new version"];obj.chkstatus=ext_check_info[j]["check status"];obj.detail_num=j+1}}if(type!="check"&&obj.newver!="0"){for(var j=0,len2=ext_upg_info.length;j<len2;j++){if(ext_upg_info[j]["mac address"]==obj.mac){obj.upgstatus=ext_upg_info[j]["upgrade status"]}}}if(obj.bhstatus=="0"){obj.chkstatus=-1}if(obj.curver=="0"){obj.curver="--.--.--.--"}fw_info.push(obj)}if(isCDLESS()||isWIZARD()){dropped_num=satellite_num-(ext_dev_info.length-null_dev_num)}else{dropped_num=0}for(var i=0;i<dropped_num;i++){var dropped_obj={type:ORT_005,mac:"",modelname:sate_default_name,devname:sate_default_name,bhstatus:"0",curver:"--.--.--.--",newver:"",chkstatus:-1,upgstatus:-1,detail_num:0};fw_info.push(dropped_obj)}upg_flag=1;for(var i=0,len=fw_info.length;i<len;i++){if(fw_info[i].chkstatus!=="000"&&fw_info[i].bhstatus!=="0"){upg_flag=0;break}}}function send_analytics(){if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){console.log(xmlhttp.responseText)}};xmlhttp.open("GET","send_firmware_analytics.html?ts="+new Date().getTime(),true);xmlhttp.send()}function refresh_content(n){var c,p;var b,d,q,a,h,j,f;var m,g;var l=0;var k=0,o=0;router_success=0;var e="<table border=1 cellpadding=2 cellspacing=0><tr><td></td><td>"+orbi_model_name+"</td><td>"+edit_devname+"</td><td>"+old_ver+"</td><td>"+stalist_Status+"</td></tr>";newVer_count=0,router_newVer=0;if(window.XMLHttpRequest){c=new XMLHttpRequest()}else{c=new ActiveXObject("Microsoft.XMLHTTP")}c.onreadystatechange=function(){if(c.readyState==4&&c.status==200){update_fw_info(n,c.responseText);for(var u=0,r=fw_info.length;u<r;u++){var s=fw_info[u]["chkstatus"],v=fw_info[u]["upgstatus"],x=fw_info[u]["newver"];if(control_firmware_support=="1"){var t=fw_info[0]["urlstatus"],w=fw_info[0]["chkstatus"]}if(s==-1){f=wait_for_conn}else{if(wan_status==1){if(n=="check"||s!=="000"||x=="0"){if(s=="000"&&x!="0"){f='<a class="havenew" onclick="see_detail('+fw_info[u]["detail_num"]+')">'+fw_info[u]["newver"]+"</a>";newVer_count++;if(u==0){router_newVer=1}}else{if(s=="000"&&x=="0"){f=no_new_version}else{if(s=="001"){f=no_internet}else{if(s=="002"||(control_firmware_support=="1"&&w=="002"&&t=="0")){f=serv_unreachable}else{if(s=="003"||(control_firmware_support=="1"&&u==0&&s=="006")){f=upg_failed}else{if(s=="005"&&wait_time<MAX_CHK_TRIES&&n=="check"){f=down_in_back;k++}else{if(s==="004"){f=upg_failed}else{if(wait_time>=MAX_CHK_TRIES){f=upg_failed;dropped_num++}else{f=plz_wait_moment;k++}}}}}}}}if(control_firmware_support=="1"&&u!=0&&w=="0"&&(s=="000"||s=="002"||s=="003"||s==="004")&&wait_time<MAX_CHK_TRIES){f=plz_wait_moment}}else{if(n=="upgrade"){if(v=="001"||v=="002"){f=upg_failed}else{if(wait_time>=MAX_UPG_TRIES){f="No response"}else{if(v=="000"){o++;if(u==0){router_success=1}}else{k++}f=ORT_013}}}}}else{f=no_internet}}if(n=="check"&&u==0){if(s=="005"||s=="0"||s=="006"){check_satellite_times=0}else{check_satellite_times++}}e=e+"<tr><td>"+fw_info[u]["type"]+"</td><td>"+fw_info[u]["modelname"]+"</td><td>"+fw_info[u]["devname"]+"</td><td>"+fw_info[u]["curver"]+'</td><td style="text-align:left">'+f+"</td></tr>"}e=e+"</table>";document.getElementById("fw_check_table").innerHTML=e;console.log("wait_count:"+k+"; wait_time:"+wait_time+"; type:"+n+"; router_success:"+router_success+"; check_satellite_times:"+check_satellite_times);if(n=="check"&&(wait_time<1||k>0&&wait_time<MAX_CHK_TRIES)){document.getElementById("refresh").disabled=true;document.getElementById("upgrade_all").disabled=true;timeout=setTimeout("refresh_content('check');",wait_time<10?1000:5000);wait_time++}else{if(n=="upgrade"&&router_success==0&&k>0&&wait_time<MAX_UPG_TRIES){document.getElementById("refresh").disabled=true;document.getElementById("upgrade_all").disabled=true;timeout=setTimeout("refresh_content('upgrade');",3000);wait_time++}else{if(n=="upgrade"&&(o>0||router_success==1)){document.location.href="pls_wait.html"}else{if(n=="check"&&newVer_count==0&&upg_flag==1&&(isCDLESS()||isWIZARD())){document.getElementById("refresh").disabled=false;document.getElementById("upgrade_all").disabled=false;document.getElementById("upgrade_all").value=next_mark;if(top.location.href.indexOf("BRS_index.htm")==-1){top.topframe.location.reload()}send_analytics()}else{if(dropped_num>0||upg_flag==0||n=="check"&&newVer_count==0||n=="upgrade"){if(n=="check"){send_analytics()}document.getElementById("refresh").disabled=false;document.getElementById("upgrade_all").disabled=true;if(top.location.href.indexOf("BRS_index.htm")==-1){top.topframe.location.reload()}}else{document.getElementById("refresh").disabled=false;document.getElementById("upgrade_all").disabled=false;if(top.location.href.indexOf("BRS_index.htm")==-1){top.topframe.location.reload()}if(n=="check"){send_analytics()}}}}}}}};c.open("GET","online_upgrade_info.html?ts="+new Date().getTime(),true);c.send()}function do_upgrade(b,a){if(router_newVer==1&&newVer_count>1){b.submit_flag.value="upgrade_orbi_image";b.action="/func.cgi?/"+a+"?type=upgrade timestamp="+ts;b.submit()}else{if(router_newVer==1){b.submit_flag.value="upgrade_base_image";b.action="/func.cgi?/"+a+"?type=upgrade timestamp="+ts;b.submit()}else{if(newVer_count>0){b.submit_flag.value="upgrade_satellite_image";b.action="/apply.cgi?/"+a+"?type=upgrade timestamp="+ts;b.submit()}else{if(newVer_count==0&&upg_flag==1&&(isCDLESS()||isWIZARD())){toInternet()}}}}}function auto_upgrade(b,a){if(b.auto_upg[0].checked){b.hidden_auto_upg.value="1"}else{b.hidden_auto_upg.value="0"}b.submit_flag.value="orbi_auto_upgrade";b.action="/apply.cgi?/"+a+"?type=check timestamp="+ts;b.submit()}function do_check(b,a){b.submit_flag.value="download_orbi_confile";b.action="/func.cgi?/"+a+"?type=check timestamp="+ts;b.submit()}function update_devname(){for(var c=0,a=ext_dev_info.length;c<a;c++){var b=device_names[ext_dev_info[c]["mac address"]];if(typeof b!="undefined"){ext_dev_info[c]["device name"]=b}}}function init_check_table(){var c="<table border=1 cellpadding=2 cellspacing=0 width=80%><tr><td></td><td>"+orbi_model_name+"</td><td>"+edit_devname+"</td><td>"+old_ver+"</td><td>"+stalist_Status+"</td></tr>";c+="<tr><td>"+router_status_router+"</td><td>"+base_dev_info["module name"]+"</td><td>"+base_dev_info["device name"]+"</td><td>"+base_dev_info["current version"]+"</td><td></td></tr>";for(var b=0,a=ext_dev_info.length;b<a;b++){if(ext_dev_info[b]["mac address"]==undefined){continue}if(ext_dev_info[b]["current version"]!="0"){c+="<tr><td>"+ORT_005+"</td><td>"+ext_dev_info[b]["module name"]+"</td><td>"+ext_dev_info[b]["device name"]+"</td><td>"+ext_dev_info[b]["current version"]+"</td><td></td></tr>"}else{c+="<tr><td>"+ORT_005+"</td><td>"+ext_dev_info[b]["module name"]+"</td><td>"+ext_dev_info[b]["device name"]+"</td><td>--.--.--.--</td><td></td></tr>"}}c+="</table>";document.getElementById("fw_check_table").innerHTML=c;document.getElementById("refresh").disabled=true;document.getElementById("upgrade_all").disabled=true};